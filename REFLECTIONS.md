Есть мысль делать это не через CPUID , а выставлением perf_event и чтением из procfs. Надо будет на досуге попробовать)
